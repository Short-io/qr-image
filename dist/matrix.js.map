{"version":3,"file":"matrix.js","sourceRoot":"","sources":["../src/matrix.ts"],"names":[],"mappings":"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","sourcesContent":["// {{{1 Initialize matrix with zeros\nfunction init(version) {\n  const N = version * 4 + 17;\n  const matrix = [];\n  let zeros = Buffer.alloc(N);\n  zeros.fill(0);\n  zeros = [].slice.call(zeros);\n  for (let i = 0; i < N; i++) {\n    matrix[i] = zeros.slice();\n  }\n  return matrix;\n}\n\n// {{{1 Put finders into matrix\nfunction fillFinders(matrix) {\n  const N = matrix.length;\n  for (var i = -3; i <= 3; i++) {\n    for (let j = -3; j <= 3; j++) {\n      const max = Math.max(i, j);\n      const min = Math.min(i, j);\n      const pixel = (max == 2 && min >= -2) || (min == -2 && max <= 2) ? 0x80 : 0x81;\n      matrix[3 + i][3 + j] = pixel;\n      matrix[3 + i][N - 4 + j] = pixel;\n      matrix[N - 4 + i][3 + j] = pixel;\n    }\n  }\n  for (var i = 0; i < 8; i++) {\n    matrix[7][i] = matrix[i][7] = matrix[7][N - i - 1] = matrix[i][N - 8] = matrix[N - 8][i] = matrix[N - 1 - i][7] = 0x80;\n  }\n}\n\n// {{{1 Put align and timinig\nfunction fillAlignAndTiming(matrix) {\n  const N = matrix.length;\n  if (N > 21) {\n    const len = N - 13;\n    let delta = Math.round(len / Math.ceil(len / 28));\n    if (delta % 2) delta++;\n    const res = [];\n    for (let p = len + 6; p > 10; p -= delta) {\n      res.unshift(p);\n    }\n    res.unshift(6);\n    for (var i = 0; i < res.length; i++) {\n      for (let j = 0; j < res.length; j++) {\n        const x = res[i]; const\n          y = res[j];\n        if (matrix[x][y]) continue;\n        for (let r = -2; r <= 2; r++) {\n          for (let c = -2; c <= 2; c++) {\n            const max = Math.max(r, c);\n            const min = Math.min(r, c);\n            const pixel = (max == 1 && min >= -1) || (min == -1 && max <= 1) ? 0x80 : 0x81;\n            matrix[x + r][y + c] = pixel;\n          }\n        }\n      }\n    }\n  }\n  for (var i = 8; i < N - 8; i++) {\n    matrix[6][i] = matrix[i][6] = i % 2 ? 0x80 : 0x81;\n  }\n}\n\n// {{{1 Fill reserved areas with zeroes\nfunction fillStub(matrix) {\n  const N = matrix.length;\n  for (var i = 0; i < 8; i++) {\n    if (i != 6) {\n      matrix[8][i] = matrix[i][8] = 0x80;\n    }\n    matrix[8][N - 1 - i] = 0x80;\n    matrix[N - 1 - i][8] = 0x80;\n  }\n  matrix[8][8] = 0x80;\n  matrix[N - 8][8] = 0x81;\n\n  if (N < 45) return;\n\n  for (var i = N - 11; i < N - 8; i++) {\n    for (let j = 0; j < 6; j++) {\n      matrix[i][j] = matrix[j][i] = 0x80;\n    }\n  }\n}\n\n// {{{1 Fill reserved areas\nconst fillReserved = (function () {\n  const FORMATS = Array(32);\n  const VERSIONS = Array(40);\n\n  const gf15 = 0x0537;\n  const gf18 = 0x1f25;\n  const formats_mask = 0x5412;\n\n  for (let format = 0; format < 32; format++) {\n    var res = format << 10;\n    for (var i = 5; i > 0; i--) {\n      if (res >>> (9 + i)) {\n        res ^= (gf15 << (i - 1));\n      }\n    }\n    FORMATS[format] = (res | (format << 10)) ^ formats_mask;\n  }\n\n  for (let version = 7; version <= 40; version++) {\n    var res = version << 12;\n    for (var i = 6; i > 0; i--) {\n      if (res >>> (11 + i)) {\n        res ^= (gf18 << (i - 1));\n      }\n    }\n    VERSIONS[version] = (res | (version << 12));\n  }\n\n  const EC_LEVELS = {\n    L: 1, M: 0, Q: 3, H: 2,\n  };\n\n  return function fillReserved(matrix, ec_level, mask) {\n    const N = matrix.length;\n    const format = FORMATS[EC_LEVELS[ec_level] << 3 | mask];\n    function F(k) { return format >> k & 1 ? 0x81 : 0x80; }\n    for (var i = 0; i < 8; i++) {\n      matrix[8][N - 1 - i] = F(i);\n      if (i < 6) matrix[i][8] = F(i);\n    }\n    for (var i = 8; i < 15; i++) {\n      matrix[N - 15 + i][8] = F(i);\n      if (i > 8) matrix[8][14 - i] = F(i);\n    }\n    matrix[7][8] = F(6);\n    matrix[8][8] = F(7);\n    matrix[8][7] = F(8);\n\n    const version = VERSIONS[(N - 17) / 4];\n    if (!version) return;\n    function V(k) { return version >> k & 1 ? 0x81 : 0x80; }\n    for (var i = 0; i < 6; i++) {\n      for (let j = 0; j < 3; j++) {\n        matrix[N - 11 + j][i] = matrix[i][N - 11 + j] = V(i * 3 + j);\n      }\n    }\n  };\n}());\n\n// {{{1 Fill data\nconst fillData = (function () {\n  const MASK_FUNCTIONS = [\n    function (i, j) { return (i + j) % 2 == 0; },\n    function (i, j) { return i % 2 == 0; },\n    function (i, j) { return j % 3 == 0; },\n    function (i, j) { return (i + j) % 3 == 0; },\n    function (i, j) { return (Math.floor(i / 2) + Math.floor(j / 3)) % 2 == 0; },\n    function (i, j) { return (i * j) % 2 + (i * j) % 3 == 0; },\n    function (i, j) { return ((i * j) % 2 + (i * j) % 3) % 2 == 0; },\n    function (i, j) { return ((i * j) % 3 + (i + j) % 2) % 2 == 0; },\n  ];\n\n  return function fillData(matrix, data, mask) {\n    const N = matrix.length;\n    let row; let col; let\n      dir = -1;\n    row = col = N - 1;\n    const mask_fn = MASK_FUNCTIONS[mask];\n    let len = data.blocks[data.blocks.length - 1].length;\n\n    for (var i = 0; i < len; i++) {\n      for (var b = 0; b < data.blocks.length; b++) {\n        if (data.blocks[b].length <= i) continue;\n        put(data.blocks[b][i]);\n      }\n    }\n\n    len = data.ec_len;\n    for (var i = 0; i < len; i++) {\n      for (var b = 0; b < data.ec.length; b++) {\n        put(data.ec[b][i]);\n      }\n    }\n\n    if (col > -1) {\n      do {\n        matrix[row][col] = mask_fn(row, col) ? 1 : 0;\n      } while (next());\n    }\n\n    function put(byte) {\n      for (let mask = 0x80; mask; mask >>= 1) {\n        let pixel = !!(mask & byte);\n        if (mask_fn(row, col)) pixel = !pixel;\n        matrix[row][col] = pixel ? 1 : 0;\n        next();\n      }\n    }\n\n    function next() {\n      do {\n        if ((col % 2) ^ (col < 6)) {\n          if (dir < 0 && row == 0 || dir > 0 && row == N - 1) {\n            col--;\n            dir = -dir;\n          } else {\n            col++;\n            row += dir;\n          }\n        } else {\n          col--;\n        }\n        if (col == 6) {\n          col--;\n        }\n        if (col < 0) {\n          return false;\n        }\n      } while (matrix[row][col] & 0xf0);\n      return true;\n    }\n  };\n}());\n\n// {{{1 Calculate penalty\nfunction calculatePenalty(matrix) {\n  const N = matrix.length;\n  let penalty = 0;\n  // Rule 1\n  for (var i = 0; i < N; i++) {\n    var pixel = matrix[i][0] & 1;\n    var len = 1;\n    for (var j = 1; j < N; j++) {\n      var p = matrix[i][j] & 1;\n      if (p == pixel) {\n        len++;\n        continue;\n      }\n      if (len >= 5) {\n        penalty += len - 2;\n      }\n      pixel = p;\n      len = 1;\n    }\n    if (len >= 5) {\n      penalty += len - 2;\n    }\n  }\n  for (var j = 0; j < N; j++) {\n    var pixel = matrix[0][j] & 1;\n    var len = 1;\n    for (var i = 1; i < N; i++) {\n      var p = matrix[i][j] & 1;\n      if (p == pixel) {\n        len++;\n        continue;\n      }\n      if (len >= 5) {\n        penalty += len - 2;\n      }\n      pixel = p;\n      len = 1;\n    }\n    if (len >= 5) {\n      penalty += len - 2;\n    }\n  }\n\n  // Rule 2\n  for (var i = 0; i < N - 1; i++) {\n    for (var j = 0; j < N - 1; j++) {\n      const s = matrix[i][j] + matrix[i][j + 1] + matrix[i + 1][j] + matrix[i + 1][j + 1] & 7;\n      if (s == 0 || s == 4) {\n        penalty += 3;\n      }\n    }\n  }\n\n  // Rule 3\n  function I(k) { return matrix[i][j + k] & 1; }\n  function J(k) { return matrix[i + k][j] & 1; }\n  for (var i = 0; i < N; i++) {\n    for (var j = 0; j < N; j++) {\n      if (j < N - 6 && I(0) && !I(1) && I(2) && I(3) && I(4) && !I(5) && I(6)) {\n        if (j >= 4 && !(I(-4) || I(-3) || I(-2) || I(-1))) {\n          penalty += 40;\n        }\n        if (j < N - 10 && !(I(7) || I(8) || I(9) || I(10))) {\n          penalty += 40;\n        }\n      }\n\n      if (i < N - 6 && J(0) && !J(1) && J(2) && J(3) && J(4) && !J(5) && J(6)) {\n        if (i >= 4 && !(J(-4) || J(-3) || J(-2) || J(-1))) {\n          penalty += 40;\n        }\n        if (i < N - 10 && !(J(7) || J(8) || J(9) || J(10))) {\n          penalty += 40;\n        }\n      }\n    }\n  }\n\n  // Rule 4\n  let numDark = 0;\n  for (var i = 0; i < N; i++) {\n    for (var j = 0; j < N; j++) {\n      if (matrix[i][j] & 1) numDark++;\n    }\n  }\n  penalty += 10 * Math.floor(Math.abs(10 - 20 * numDark / (N * N)));\n\n  return penalty;\n}\n\n// {{{1 All-in-one function\nfunction getMatrix(data) {\n  const matrix = init(data.version);\n  fillFinders(matrix);\n  fillAlignAndTiming(matrix);\n  fillStub(matrix);\n\n  let penalty = Infinity;\n  let bestMask = 0;\n  for (let mask = 0; mask < 8; mask++) {\n    fillData(matrix, data, mask);\n    fillReserved(matrix, data.ec_level, mask);\n    const p = calculatePenalty(matrix);\n    if (p < penalty) {\n      penalty = p;\n      bestMask = mask;\n    }\n  }\n\n  fillData(matrix, data, bestMask);\n  fillReserved(matrix, data.ec_level, bestMask);\n\n  return matrix.map((row) => row.map((cell) => cell & 1));\n}\n\n// {{{1 export functions\nmodule.exports = {\n  getMatrix,\n  init,\n  fillFinders,\n  fillAlignAndTiming,\n  fillStub,\n  fillReserved,\n  fillData,\n  calculatePenalty,\n};\n"]}