{"version":3,"file":"errorcode.js","sourceRoot":"","sources":["../src/errorcode.ts"],"names":[],"mappings":"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","sourcesContent":["// {{{1 Galois Field Math\nconst GF256_BASE = 285;\n\nconst EXP_TABLE = [1];\nconst LOG_TABLE = [];\n\nfor (var i = 1; i < 256; i++) {\n  let n = EXP_TABLE[i - 1] << 1;\n  if (n > 255) n ^= GF256_BASE;\n  EXP_TABLE[i] = n;\n}\n\nfor (var i = 0; i < 255; i++) {\n  LOG_TABLE[EXP_TABLE[i]] = i;\n}\n\nfunction exp(k) {\n  while (k < 0) k += 255;\n  while (k > 255) k -= 255;\n  return EXP_TABLE[k];\n}\n\nfunction log(k) {\n  if (k < 1 || k > 255) {\n    throw Error(`Bad log(${k})`);\n  }\n  return LOG_TABLE[k];\n}\n\n// {{{1 Generator Polynomials\nconst POLYNOMIALS = [\n  [0], // a^0 x^0\n  [0, 0], // a^0 x^1 + a^0 x^0\n  [0, 25, 1], // a^0 x^2 + a^25 x^1 + a^1 x^0\n  // and so on...\n];\n\nfunction generatorPolynomial(num) {\n  if (POLYNOMIALS[num]) {\n    return POLYNOMIALS[num];\n  }\n  const prev = generatorPolynomial(num - 1);\n  const res = [];\n\n  res[0] = prev[0];\n  for (let i = 1; i <= num; i++) {\n    res[i] = log(exp(prev[i]) ^ exp(prev[i - 1] + num - 1));\n  }\n  POLYNOMIALS[num] = res;\n  return res;\n}\n\n// {{{1 export functions\nmodule.exports = function calculate_ec(msg, ec_len) {\n  // `msg` could be array or buffer\n  // convert `msg` to array\n  msg = [].slice.call(msg);\n\n  // Generator Polynomial\n  const poly = generatorPolynomial(ec_len);\n\n  for (var i = 0; i < ec_len; i++) msg.push(0);\n  while (msg.length > ec_len) {\n    if (!msg[0]) {\n      msg.shift();\n      continue;\n    }\n    const log_k = log(msg[0]);\n    for (var i = 0; i <= ec_len; i++) {\n      msg[i] = msg[i] ^ exp(poly[i] + log_k);\n    }\n    msg.shift();\n  }\n  return Buffer.from(msg);\n};\n"]}