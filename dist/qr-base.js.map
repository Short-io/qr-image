{"version":3,"file":"qr-base.js","sourceRoot":"","sources":["../src/qr-base.ts"],"names":[],"mappings":"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,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC;IACzC,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC;IACzC,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC;IACzC,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,CAAC;IAC1C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC3C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC3C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC5C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC5C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC5C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC5C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC5C,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC;IAC5C,CAAC,IAAI,EAAE,GA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","sourcesContent":["/* eslint-disable no-plusplus */\n/* eslint-disable camelcase */\n/* eslint-disable no-bitwise */\nconst encode = require('./encode');\nconst calculateEC = require('./errorcode');\nconst matrix = require('./matrix');\n\nfunction deepCopy(obj) {\n  return JSON.parse(JSON.stringify(obj));\n}\n\nconst EC_LEVELS = ['L', 'M', 'Q', 'H'];\n\n// {{{1 Versions\nlet versions = [\n  [], // there is no version 0\n  // total number of codewords, (number of ec codewords, number of blocks) * ( L, M, Q, H )\n  [26, 7, 1, 10, 1, 13, 1, 17, 1],\n  [44, 10, 1, 16, 1, 22, 1, 28, 1],\n  [70, 15, 1, 26, 1, 36, 2, 44, 2],\n  [100, 20, 1, 36, 2, 52, 2, 64, 4],\n  [134, 26, 1, 48, 2, 72, 4, 88, 4], // 5\n  [172, 36, 2, 64, 4, 96, 4, 112, 4],\n  [196, 40, 2, 72, 4, 108, 6, 130, 5],\n  [242, 48, 2, 88, 4, 132, 6, 156, 6],\n  [292, 60, 2, 110, 5, 160, 8, 192, 8],\n  [346, 72, 4, 130, 5, 192, 8, 224, 8], // 10\n  [404, 80, 4, 150, 5, 224, 8, 264, 11],\n  [466, 96, 4, 176, 8, 260, 10, 308, 11],\n  [532, 104, 4, 198, 9, 288, 12, 352, 16],\n  [581, 120, 4, 216, 9, 320, 16, 384, 16],\n  [655, 132, 6, 240, 10, 360, 12, 432, 18], // 15\n  [733, 144, 6, 280, 10, 408, 17, 480, 16],\n  [815, 168, 6, 308, 11, 448, 16, 532, 19],\n  [901, 180, 6, 338, 13, 504, 18, 588, 21],\n  [991, 196, 7, 364, 14, 546, 21, 650, 25],\n  [1085, 224, 8, 416, 16, 600, 20, 700, 25], // 20\n  [1156, 224, 8, 442, 17, 644, 23, 750, 25],\n  [1258, 252, 9, 476, 17, 690, 23, 816, 34],\n  [1364, 270, 9, 504, 18, 750, 25, 900, 30],\n  [1474, 300, 10, 560, 20, 810, 27, 960, 32],\n  [1588, 312, 12, 588, 21, 870, 29, 1050, 35], // 25\n  [1706, 336, 12, 644, 23, 952, 34, 1110, 37],\n  [1828, 360, 12, 700, 25, 1020, 34, 1200, 40],\n  [1921, 390, 13, 728, 26, 1050, 35, 1260, 42],\n  [2051, 420, 14, 784, 28, 1140, 38, 1350, 45],\n  [2185, 450, 15, 812, 29, 1200, 40, 1440, 48], // 30\n  [2323, 480, 16, 868, 31, 1290, 43, 1530, 51],\n  [2465, 510, 17, 924, 33, 1350, 45, 1620, 54],\n  [2611, 540, 18, 980, 35, 1440, 48, 1710, 57],\n  [2761, 570, 19, 1036, 37, 1530, 51, 1800, 60],\n  [2876, 570, 19, 1064, 38, 1590, 53, 1890, 63], // 35\n  [3034, 600, 20, 1120, 40, 1680, 56, 1980, 66],\n  [3196, 630, 21, 1204, 43, 1770, 59, 2100, 70],\n  [3362, 660, 22, 1260, 45, 1860, 62, 2220, 74],\n  [3532, 720, 24, 1316, 47, 1950, 65, 2310, 77],\n  [3706, 750, 25, 1372, 49, 2040, 68, 2430, 81], // 40\n];\n\nversions = versions.map((v, index) => {\n  if (!index) return {};\n\n  const res = {\n  };\n  for (let i = 1; i < 8; i += 2) {\n    const length = v[0] - v[i];\n    const num_template = v[i + 1];\n    const ec_level = EC_LEVELS[(i / 2) | 0];\n    const level = {\n      version: index,\n      ec_level,\n      data_len: length,\n      ec_len: v[i] / num_template,\n      blocks: [],\n      ec: [],\n    };\n\n    for (let k = num_template, n = length; k > 0; k--) {\n      const block = (n / k) | 0;\n      level.blocks.push(block);\n      n -= block;\n    }\n    res[ec_level] = level;\n  }\n  return res;\n});\n\n// {{{1 Get version template\nfunction getTemplate(message, ec_level) {\n  let i = 1;\n  let len;\n\n  if (message.data1) {\n    len = Math.ceil(message.data1.length / 8);\n  } else {\n    i = 10;\n  }\n  for (/* i */; i < 10; i++) {\n    var version = versions[i][ec_level];\n    if (version.data_len >= len) {\n      return deepCopy(version);\n    }\n  }\n\n  if (message.data10) {\n    len = Math.ceil(message.data10.length / 8);\n  } else {\n    i = 27;\n  }\n  for (/* i */; i < 27; i++) {\n    var version = versions[i][ec_level];\n    if (version.data_len >= len) {\n      return deepCopy(version);\n    }\n  }\n\n  len = Math.ceil(message.data27.length / 8);\n  for (/* i */; i < 41; i++) {\n    var version = versions[i][ec_level];\n    if (version.data_len >= len) {\n      return deepCopy(version);\n    }\n  }\n  throw new Error('Too much data');\n}\n\n// {{{1 Fill template\nfunction fillTemplate(message, template) {\n  const blocks = Buffer.alloc(template.data_len);\n  blocks.fill(0);\n\n  if (template.version < 10) {\n    message = message.data1;\n  } else if (template.version < 27) {\n    message = message.data10;\n  } else {\n    message = message.data27;\n  }\n\n  const len = message.length;\n\n  for (var i = 0; i < len; i += 8) {\n    let b = 0;\n    for (let j = 0; j < 8; j++) {\n      b = (b << 1) | (message[i + j] ? 1 : 0);\n    }\n    blocks[i / 8] = b;\n  }\n\n  let pad = 236;\n  for (var i = Math.ceil((len + 4) / 8); i < blocks.length; i++) {\n    blocks[i] = pad;\n    pad = (pad == 236) ? 17 : 236;\n  }\n\n  let offset = 0;\n  template.blocks = template.blocks.map((n) => {\n    const b = blocks.slice(offset, offset + n);\n    offset += n;\n    template.ec.push(calculateEC(b, template.ec_len));\n    return b;\n  });\n\n  return template;\n}\n\n// {{{1 All-in-one\nfunction QR(text, ec_level, parse_url) {\n  ec_level = EC_LEVELS.indexOf(ec_level) > -1 ? ec_level : 'M';\n  const message = encode(text, parse_url);\n  const data = fillTemplate(message, getTemplate(message, ec_level));\n  return matrix.getMatrix(data);\n}\n\n// {{{1 export functions\nmodule.exports = {\n  QR,\n  getTemplate,\n  fillTemplate,\n};\n"]}